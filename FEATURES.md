# 新功能使用指南

本文档详细介绍了通讯录管理系统最新版本中新增的功能特性。

## 1. 排序功能

### 功能说明
支持对联系人列表进行排序，可以按以下字段排序：
- 编号 (ID)
- 姓名 (Name)
- 电话 (Phone)

每种排序都支持升序和降序两种方式。

### 使用方法
1. 点击菜单栏 **工具** → **排序**
2. 在弹出的对话框中选择排序字段
3. 勾选或取消"升序排列"选项
4. 点击"确定"完成排序

### 示例场景
- 按编号升序排列，快速定位特定ID的联系人
- 按姓名字母顺序排列，方便查找
- 按电话号码排序，整理相同区号的联系人

---

## 2. CSV 导出功能

### 功能说明
将当前的联系人列表导出为 CSV（逗号分隔值）格式文件，可以在 Excel、Google Sheets 等工具中打开和编辑。

### 使用方法
1. 点击菜单栏 **文件** → **导出到CSV**
2. 在弹出的对话框中输入文件名（默认为 `contacts_export.csv`）
3. 点击"导出"按钮
4. 文件将保存在程序运行目录下

### CSV 格式
导出的 CSV 文件包含以下列：
```
编号,姓名,性别,电话,邮箱,地址
```

### 注意事项
- 导出操作会包含当前所有联系人
- 如果正在使用搜索过滤，导出的仍然是完整列表
- 文件名会自动添加 `.csv` 扩展名（如果没有）

---

## 3. 输入验证

### 功能说明
系统现在会自动验证用户输入的数据格式，确保数据的准确性和完整性。

### 验证规则

#### 电话号码验证
- 必填字段
- 至少包含 7 个数字
- 允许包含常见分隔符：`-`、空格、`+`、`()`
- 示例有效格式：
  - `13800138000`
  - `138-0013-8000`
  - `+86 138 0013 8000`
  - `(010) 6234-5678`

#### 邮箱地址验证
- 可选字段
- 必须包含 `@` 符号
- `@` 后必须有域名（至少包含一个 `.`）
- 示例有效格式：
  - `user@example.com`
  - `name.surname@company.co.jp`

#### 必填字段检查
以下字段为必填项：
- 编号
- 姓名
- 电话

### 错误提示
如果输入不符合验证规则，系统会显示相应的错误提示：
- "请填写所有必填字段" - 缺少必填项
- "电话号码格式不正确" - 电话号码不符合格式
- "邮箱格式不正确" - 邮箱地址格式错误

---

## 4. 批量清空功能

### 功能说明
一键删除所有联系人数据，适用于需要重新开始或清理测试数据的场景。

### 使用方法
1. 点击菜单栏 **编辑** → **清空所有联系人**
2. 系统会显示警告确认对话框
3. 阅读警告信息："此操作将删除所有联系人！此操作不可恢复"
4. 点击"确定删除"执行清空操作，或点击"取消"放弃操作

### 安全提示
- ⚠️ **此操作不可恢复**
- 建议在清空前先使用"保存"或"导出到CSV"备份数据
- 如果启用了自动保存，清空操作会立即持久化

---

## 5. 统计信息

### 功能说明
实时统计和展示联系人数据的统计信息，帮助了解通讯录的整体情况。

### 使用方法
点击菜单栏 **工具** → **统计信息**

### 显示内容
- **总联系人数**：当前通讯录中的联系人总数
- **男性人数及占比**：男性联系人数量和百分比
- **女性人数及占比**：女性联系人数量和百分比
- **未指定性别人数及占比**：性别字段为空或不是"男/女"的联系人数量

### 性别识别
系统识别以下性别标识：
- 男性：`男`、`male`、`Male`、`M`、`m`
- 女性：`女`、`female`、`Female`、`F`、`f`
- 其他值视为"未指定"

---

## 6. 自动保存功能

### 功能说明
启用后，系统会在每次修改联系人数据后自动保存到 JSON 文件，无需手动点击保存。

### 使用方法
点击菜单栏 **文件** → **自动保存**（勾选表示启用）

### 自动保存时机
以下操作会触发自动保存（如果已启用）：
- 添加新联系人
- 修改联系人信息
- 删除联系人
- 清空所有联系人
- 对联系人进行排序

### 状态指示器
- 菜单栏右侧会显示绿色的 `[自动保存]` 标识
- 表示当前自动保存功能已启用

### 建议
- 对于频繁修改数据的场景，建议启用自动保存
- 如果只是浏览或测试，可以禁用以避免不必要的 I/O 操作

---

## 7. 增强的用户反馈

### 功能说明
所有操作都会在菜单栏显示实时反馈消息，让用户清楚了解操作结果。

### 反馈消息类型
- ✅ 成功消息（绿色）：
  - "联系人添加成功"
  - "联系人修改成功"
  - "联系人删除成功"
  - "数据保存成功"
  - "数据加载成功"
  - "已按XX排序"
  - "找到 X 条结果"
  - 等等

### 消息显示
- 消息显示在菜单栏右侧
- 自动显示 3 秒后消失
- 新消息会替换旧消息

---

## 8. 启动时自动加载

### 功能说明
应用程序启动时会自动从 `contacts.json` 加载之前保存的联系人数据。

### 特点
- 无需手动点击"加载"
- 如果文件不存在，显示空列表（不报错）
- 加载成功后在控制台输出联系人数量
- JSON 解析失败时会保留空列表并在控制台显示错误信息

### 数据文件位置
- 文件名：`contacts.json`
- 位置：程序运行目录
- 格式：JSON（带缩进的结构化格式）

---

## 技术改进摘要

### 代码层面的改进
1. **Manager.h/cpp**
   - 新增 `SortField` 枚举类型
   - 新增 `sortContacts()` 方法实现排序
   - 新增 `clearAllContacts()` 方法批量删除
   - 新增 `exportToCSV()` 方法导出数据
   - 新增 `getMaleCount()` 和 `getFemaleCount()` 统计方法

2. **UI.h/cpp**
   - 新增多个弹窗绘制方法
   - 新增输入验证方法 `validateEmail()` 和 `validatePhoneNumber()`
   - 新增自动保存支持 `performAutoSave()`
   - 扩展菜单栏，新增"工具"菜单
   - 在菜单栏显示自动保存状态指示器

### 用户体验改进
- 所有修改操作集成自动保存支持
- 统一的成功/错误消息反馈机制
- 更友好的确认对话框（清空操作）
- 实时的数据统计展示

---

## 未来可能的功能扩展

基于当前架构，以下功能可以轻松添加：
1. **批量导入**：从 CSV 文件导入联系人
2. **高级搜索**：多条件搜索（如：同时按性别和地区）
3. **分组标签**：为联系人添加标签或分类
4. **历史记录**：撤销/重做功能
5. **数据备份**：自动创建备份文件
6. **主题切换**：支持深色/浅色主题
7. **快捷键**：常用操作的键盘快捷键
8. **拼音搜索**：支持拼音首字母搜索中文姓名

---

## 总结

本次更新为通讯录管理系统增加了多项实用功能，显著提升了用户体验和数据管理能力。所有新功能都经过精心设计，与现有功能无缝集成，保持了界面的简洁和易用性。
